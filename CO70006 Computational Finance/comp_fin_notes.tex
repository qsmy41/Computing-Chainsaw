\documentclass[twocolumn,landscape,10pt]{article}
\usepackage[thinc]{esdiff} % for typesettign derivatives
\usepackage{amsthm} % provides an enhanced version of LaTex's \newtheorem command
\usepackage{mdframed} % framed environments that can split at page boundaries
\usepackage{enumitem} % bulletin points or other means of listing things
\usepackage{amssymb} % for AMS symbols
\usepackage{amsmath} % so as to use align
\usepackage{latexsym} % so as to use symbols like \leadsto
\usepackage{mathrsfs} % for using mathscr for char like operators
\usepackage{commath} % for using norm symbol
\usepackage{mathtools} % for using environments like dcases
\usepackage{authblk} % for writing affiliations
\usepackage{graphicx} % for importing images
\graphicspath{{./images/}} % for the path to images, also always put label behind captions
\usepackage{textcomp} % for using degree symbol
\usepackage{hyperref} % for clickable link in the pdf & customizable reference text
\usepackage[all]{hypcap} % for clickable link to images instead of caption
\usepackage[margin=0.9in]{geometry} % default is 1.5in
% \usepackage[left=0.4in, right=0.4in, top=0.8in, bottom=0.8in]{geometry}
\usepackage[title]{appendix} % for attaching appendix
\allowdisplaybreaks % allow page breaking in display maths, like align
\usepackage{xcolor} % for setting color of a block of text, use \textcolor{<color>}{}
\usepackage[normalem]{ulem} % for strikethrough text, use \sout{}
% allow for more advanced table layout
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{siunitx}
% for adjusting caption settings
\usepackage{caption}
\captionsetup[table]{skip=10pt}

\theoremstyle{definition}
\mdfdefinestyle{defEnv}{%
  hidealllines=false,
  nobreak=true,
  innertopmargin=-1ex,
}

% The following is for writing block of code
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

% setting of the thickness of the 4 lines of box
\setlength{\fboxrule}{2pt}

% Use the following to change code language and related settings
\lstset{frame=tb,
  language=Python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3,
  literate={~} {$\sim$}{1}
}

\pagestyle{headings}
\author{Lectured by Panos Parpas}
\title{Computational Finance}
\affil{Typed by Aris Zhu Yi Qing}
\begin{document}
\maketitle
\tableofcontents

\newpage

\section{Introduction}

\begin{itemize}
    \item \textbf{\underline{Forward contract}}: a customized \emph{binding} 
        contract to buy/sell an asset at a specific price 
        (\textbf{\underline{forward price}}) on a \emph{future} date.
    \item \textbf{\underline{American option}}: gives the holder the
        \emph{right} to exercise the option at any time before the
        date of expiration.
    \item \textbf{\underline{European option}}: can only be exercised
        at the date of expiration.
    \item \textbf{\underline{call/put option}}: gives the holder the
        \emph{right} to buy/sell.
        \textbf{\underline{}}
    \item \textbf{\underline{Derivative asset}}: assets defined in terms of
        underlying financial asset.
\end{itemize} 

\section{The Binomial Model}

\subsection{The One Period Model}

\subsubsection{Definitions}

\begin{itemize}
    \item 
        \textbf{\underline{Bond}} price process is deterministic and given by
        \begin{align*}
            B_0 & = 1, \\
            B_1 & = 1 + R.
        \end{align*}
        where constant $R$ is the spot rate for the period.
    \item
        \textbf{\underline{Stock}} price process is stochastic and given by
        \begin{align*}
            S_0 & = s, \\
            S_1 & = s\cdot Z
        \end{align*}
        where $Z$ is a stochastic variable defined as
        \[
            Z =
            \begin{cases}
                u, & \text{with probability $p_u$}, \\
                d, & \text{with probability $p_d$}.
            \end{cases}
        \]
        with $p_u+p_d=1$ and the assumption that $d<u$.
    \item
        \textbf{\underline{Portfolio}} on the $(B, S)$ market is a vector
        \[
            h = (x, y).
        \]
        with a deterministic market value at $t=0$ and stochastic value at
        $t=1$.
    \item \textbf{\underline{Value Process}} of the portfolio $h$ is defined as
        \[
            V_t^h = xB_t+yS_t,\quad t=0,1,
        \]
        or, in more detail,
        \begin{align*}
            V_0^h & = x+ys, \\
            V_1^h & = x(1+R)+ysZ.
        \end{align*}
    \item \textbf{\underline{Arbitrage}} portfolio is an $h$ with the properties
        \begin{align*}
            V_0^h & = 0, \\
            V_1^h & > 0, \quad\text{\emph{with probability 1}}
        \end{align*}
\end{itemize}

\subsubsection{Contingent Claim Pricing}

\newmdtheoremenv[style=defEnv]{theorem}{Proposition}
\begin{theorem}
    The model $h$ is free of arbitrage $\iff$
    $d\le(1+R)\le u$.
\end{theorem}

\paragraph{Comments} The above proposition implies that $(1+R)$ is a convex
combination of $u$ and $d$, i.e.\
\[
    1+R=q_u\cdot u + q_d\cdot d,
\]
where $q_u$ and $q_d$ can be interpreted as probabilities for a new probability
measure $Q$ with $P(Z=u)=q_u$ and $P(Z=d)=q_d$. Denoting expectation w.r.t. this
measure by $E^Q$ and with the following calculation
\[
    \frac{1}{1+R}E^Q[S_1]=\frac{1}{1+R}[q_usu+q_dsd]=\frac{1}{1+R}\cdot
    s(1+R)=s,
\]
we arrive at the following relation
\[
    s=\frac{1}{1+R}E^Q[S_1].
\]

\newmdtheoremenv[style=defEnv]{martingale measure}[theorem]{Definition}
\begin{martingale measure}
    A probability measure $Q$ is \textbf{\underline{martingale}} 
    if the following condition holds:
    \[
        S_0=\frac{1}{1+R}E^Q[S_1].
    \]
\end{martingale measure}

\newmdtheoremenv[style=defEnv]{arbitrage free 1}[theorem]{Proposition}
\begin{arbitrage free 1}
    Arbitrage-free model $\iff$ $\exists$ martingale measure $Q$.
\end{arbitrage free 1}

\newmdtheoremenv[style=defEnv]{binomial model martingale}[theorem]{Proposition}
\begin{binomial model martingale}
    For the binomial model above, the martingale probabilities are
    \[
        \begin{cases}
            q_u=\dfrac{(1+R)-d}{u-d}, \\[2ex]
            q_d=\dfrac{u-(1+R)}{u-d}.
        \end{cases}
    \]
\end{binomial model martingale}

\begin{proof}
Solve the system of equation
\[
    \begin{cases}
        1+R=q_u\cdot u+q_d\cdot d\\
        q_u+q_d=1.
    \end{cases}
\]
\end{proof}

\newmdtheoremenv[style=defEnv]{contingent claim}[theorem]{Definition}
\begin{contingent claim}
    A \textbf{\underline{contingent claim}} (financial derivative) is any
    stchastic variable $X$ of the form $X=\Phi(Z)$, where $Z$ is the stochastic
    variable driving the stock price process above, $\Phi$ is the
    \textbf{\underline{contract function}}.
\end{contingent claim}

\newtheorem{contingent claim eg}[theorem]{Example}
\begin{contingent claim eg}
European call option on the stock with
strike price $K$. Assuming that $sd<K<su$, we have
\[
    X=
    \begin{cases}
        su-K, &\text{if $Z=u$},\\
        0, &\text{if $Z=d$},
    \end{cases}
\]
so the contract function is given by
\begin{align*}
    \Phi(u) & = su-K,\\
    \Phi(d) & = 0.
\end{align*}
\end{contingent claim eg}

\newmdtheoremenv[style=defEnv]{replicated and reachable}[theorem]{Definition}
\begin{replicated and reachable}
    A given contingent claim $X$ can be \textbf{\underline{replicated}} / is
    \textbf{\underline{reachable}} if
    \[
        \exists h \text{ s.t. } V_1^h=X,\;\text{with probability 1}.
    \]
    We call such an $h$ a
    \textbf{\underline{hedging}}/\textbf{\underline{replicating}} portfolio.
    If all claims can be replicated, then the market is
    \textbf{\underline{complete}}.
\end{replicated and reachable}

\newmdtheoremenv[style=defEnv]{X pricing based on V}[theorem]{Proposition}
\begin{X pricing based on V}
    If a claim $X$ is reachable with replicating portfolio $h$, then the only
    reasonable price process for $X$ is
    \[
        \Pi_t[X]=V_t^h, \;t=0,1.
    \]
    Here, ``reasonable'' means that $\Pi_0[X]\neq V_0^h\Rightarrow$ arbitrage
    possibility.
\end{X pricing based on V}

\newmdtheoremenv[style=defEnv]{no arbitrage leads to complete}[theorem]{Proposition}
\begin{no arbitrage leads to complete}
    The general binomial model is free of arbitrage $\Rightarrow$ it is
    complete.
\end{no arbitrage leads to complete}

\begin{proof}
    Say a claim $X$ has contract function $\Phi$ s.t. \[
        V_1^h=
        \begin{cases}
            \Phi(u), & \text{ if $Z=u$}\\
            \Phi(d), & \text{ if $Z=d$},
        \end{cases}
    \]
    we can obtain the following system of equations by expanding $V_1^h$
    \begin{align*}
        (1+R)x+xuy&=\Phi(u),\\
        (1+R)x+xdy&=\Phi(d),
    \end{align*}
    and solve it to find out the replicating portfolio as
    \begin{align*}
        x&=\frac{1}{1+R}\cdot \frac{u\Phi(d)-d\Phi(u)}{u-d},\\
        y&=\frac{1}{s}\cdot \frac{\Phi(u)-\Phi(d)}{u-d}.
    \end{align*}
\end{proof}

\newmdtheoremenv[style=defEnv]{claim pricing prop}[theorem]{Proposition}
\begin{claim pricing prop}
    If the binomial model is free of arbitrage, then the arbitrage free price of
    a contingent claim $X$ is
    \[
        \Pi_0[X]=\frac{1}{1+R}E^Q[X],
    \]
    where the martingale measure $Q$ is uniquely determined by the relation
    \[
        S_0=\frac{1}{1+R}E^Q[S_1].
    \]
\end{claim pricing prop}

\begin{proof}
    Using the results derived previously, we can find out that
    \begin{align*}
        \Pi_0[X]
        &= x + sy \\
        &= \frac{1}{1+R}\left[\frac{(1+R)-d}{u-d}\cdot
        \Phi(u)+\frac{u-(1+R)}{u-d}\cdot \Phi(d)\right]\\
        &= \frac{1}{1+R}\left[\Phi(u)q_u+\Phi(d)q_d\right]\\
        &= \frac{1}{1+R}E^Q[X].
    \end{align*}
\end{proof}

\subsection{The Multiperiod Model}

\subsubsection{Definitions}

\begin{itemize}
    \item Model
        \begin{itemize}
            \item The bond price dynamics is given by
                \[
                    B_{n+1}=(1+R)B_n,\quad B_0=1.
                \]
            \item The stock price dynamics is given by
                \[
                    S_{n+1}=S_n\cdot Z_n,\quad S_0=s.
                \]
                where $Z_0,Z_1,\ldots,Z_{T-1}$ are assumed to be i.i.d.
                stochastic variables, with only two variables $u$ and $d$ and
                probabilities
                \[
                    P(Z_n=u)=p_u,\quad P(Z_n=d)=p_d.
                \]
            \item Illustrating the stock dynamics by means of a tree, we can see
                that it is \textbf{\underline{recombining}}.
        \end{itemize}
    \item A \textbf{\underline{portfolio strategy}} is a stochastic process
        \[
            \left\{h_t=(x_t,y_t);\;t=1,\ldots,T\right\}
        \]
        s.t. $h_t$ is a function of $S_0,S_1,\ldots,S_{t-1}$. By convention,
        $h_0=h_1$.
        \begin{itemize}
            \item Interpretation of $h_t$: at $t-1$,
                $x_t$ and $y_t$ of bonds and stocks are bought and held until time $t$.
        \end{itemize}
    \item The \textbf{\underline{value process}} corresponding to the portfolio
        $h$ is defined by
        \[
            V_t^h=x_t(1+R)+y_tS_t.
        \]
    \item A portfolio strategy $h_t$ is said to be \textbf{\underline{self-financing}} 
        if $\forall t=0,\ldots,T-1$,
        \[
            x_t(1+R)+y_tS_t = x_{t+1}+y_{t+1}S_t
        \]
        which says that the market value of the ``old'' portfolio $h_t$ 
        equals to the purchase value of the ``new'' portfolio $h_{t+1}$.
    \item An \textbf{\underline{arbitrage}} possibility is a self-financing
        portfolio $h$ with the properties
        \[
            \begin{align*}
                V_0^h &= 0, \\
                P(V_T^h\ge{}0) &= 1, \\
                P(V_T^h>0) &> 0.
            \end{align*}
        \]
    \item The \textbf{\underline{martingale}} probabilities $q_u$ and $q_d$ are
        defined as the probabilities for which the following relation holds
        \[
            s=\frac{1}{1+R}E^Q[S_{t+1}|S_t=s]
        \]
\end{itemize}

\subsubsection{Binomial Model Pricing Algorithm}

\newmdtheoremenv[style=defEnv]{arbitrage cond}[theorem]{Proposition}
\begin{arbitrage cond}
    The model is free of arbitrage $\Rightarrow$ $d\le(1+R)\le u$.
\end{arbitrage cond}

\newmdtheoremenv[style=defEnv]{assumption on u and d}[theorem]{Assumption}
\begin{assumption on u and d}
    From now, assume that $d < u$ and $d\le(1+R)\le u$.
\end{assumption on u and d}

\newmdtheoremenv[style=defEnv]{contingent claim in multi-period model}[theorem]{Definition}
\begin{contingent claim in multi-period model}
    A \textbf{\underline{contingent claim}} is a stochastic variable $X$ of the
    form
    \[
        X=\Phi(S_T),
    \]
    where the \textbf{\underline{contract function}} $\Phi$ is some given real
    valued function.
\end{contingent claim in multi-period model}


\newmdtheoremenv[style=defEnv]{replicated and reachable in multi-period model}[theorem]{Definition}
\begin{replicated and reachable in multi-period model}
    A given contingent claim $X$ can be \textbf{\underline{replicated}} / is
    \textbf{\underline{reachable}} if
    \[
        \exists \text{ self-financing } h \text{ s.t. } V_T^h=X,\;\text{with probability 1}.
    \]
    We call such an $h$ a
    \textbf{\underline{hedging}}/\textbf{\underline{replicating}} portfolio.
    If all claims can be replicated, then the market is
    \textbf{\underline{(dynamically) complete}}.
\end{replicated and reachable in multi-period model}

\newmdtheoremenv[style=defEnv]{The binomial algorithm}[theorem]{(Binomial
Algorithm) Proposition}
\begin{The binomial algorithm}
    Consider a $T$-claim $X=\Phi(S_T)$, which could be replicated with a
    self-financing portfolio $h$. Let $k$ be the number of up-moves occurred. So
    $V_t(k)$ can be computed recursively as
    \[
        \begin{cases}
            V_t(k) &=
            \dfrac{1}{1+R}\left[q_uV_{t+1}(k+1)+q_dV_{t+1}(k)\right],\\[2ex]
            V_T(k) &= \Phi(su^kd^{T-k}).
        \end{cases}
    \]
    where the martingale probabilities $q_u$ and $q_d$ are
    \[
        \begin{cases}
            q_u &= \dfrac{(1+R)-d}{u-d}\\[2ex]
            q_d &= \dfrac{u-(1+R)}{u-d}.
        \end{cases}
    \]
    and the hedging portfolio is given by
    \[
        \begin{cases}
            x_t(k) &= \dfrac{1}{1+R}\cdot \dfrac{uV_t(k)-dV_t(k+1)}{u-d},\\[2ex]
            y_t(k) &= \dfrac{1}{S_{t-1}}\cdot \dfrac{V_t(k+1)-V_t(k)}{u-d}.
        \end{cases}
    \]
    \textbf{\emph{N.B.}} 
    In Fig 2.9 in notes, (the figure might be confusing) $(-22.5,5/8)$ is both $h_0$ and $h_1$,
    $(-42.5,95/120)$ is $h_2(1)$, $(-2.5,1/8)$ is $h_2(0)$, etc.
\end{The binomial algorithm}

\newmdtheoremenv[style=defEnv]{t claim arbitrage free price}[theorem]{Proposition}
\begin{t claim arbitrage free price}
    The arbitrage free price at $t=0$ of a $T$-claim $X$ is given by
    \[
        \Pi_0[X]=\frac{1}{{(1+R)}^{T}}\cdot E^Q[X],
    \]
    where $Q$ denotes the martingale measure, or more explicitly,
    \[
        \Pi_0[X]=\frac{1}{{(1+R)}^{T}}\cdot\sum_{k=0}^{T}
        \begin{pmatrix}
            T \\
            k
        \end{pmatrix} 
        q_u^kq_d^{T-k}\Phi(su^kd^{T-k}).
    \]
\end{t claim arbitrage free price}

\newmdtheoremenv[style=defEnv]{iff condition for arbitrage free}[theorem]{Proposition}
\begin{iff condition for arbitrage free}
    $d<(1+R)<u\iff$ free of arbitrage.
\end{iff condition for arbitrage free}


\section{Brownian Motion}

\subsection{Definitions}

\begin{itemize}
    \item Let $A, B$ be two random variables, we define \textbf{\underline{equal
        in distribution}} as
        \[
            A\stackrel{d}{=}B
            \iff
            P(A\in C)=P(B\in C)\;\forall \text{ possible sets $C$}.
        \]
    \item
        We say a random variable $X$ has \textbf{\underline{stationary
        increments}} if
        \[
            X_t-X_s\stackrel{d}{=}X_{t+h}-X_{s+h} \quad\forall h>0.
        \]
    \item 
        A stochastic process $B_t$ is called a 
        \textbf{\underline{Brownian motion}} if
        \begin{itemize}
            \item $B_0 = 0$,
            \item $B_t-B_s\sim N(0,t-s) \;\forall t\ge s\ge 0$, implying
                \emph{stationary} increments,
            \item it has \emph{independent} increments.
        \end{itemize}
        with
        \begin{itemize}
            \item $\mathbb{E}[B_t] = 0$,
            \item Cov$(B_t,B_s)$ = min$\left\{t,s\right\}$. Show this using
                (Practice!)
                \begin{itemize}
                    \item $\text{Cov}(B_t,B_s)=\mathbb{E}[(B_t-\mathbb{E}[B_t])(B_s-\mathbb{E}[B_s])]$
                    \item
                        $\text{Cov}(B_t,B_s)=\mathbb{E}[B_tB_s]-\mathbb{E}[B_t]\mathbb{E}[B_s]$.
                \end{itemize}
        \end{itemize}
\end{itemize}

\subsection{Path Properties}

\begin{itemize}
    \item Paths are continuous (no jumps).
    \item Nowhere differentiable.
    \item Paths are \textbf{\underline{self-similar}}, i.e.\
        \[
            (T^HB_{t_1},\ldots,T^HB_{t_n})\stackrel{d}{=}(B_{Tt_1},\ldots,B_{Tt_n})
        \]
        with $H=0.5$ is the Hurst coefficient.
\end{itemize}

\subsection{Brownian Motion with Drift}

\begin{itemize}
    \item A \textbf{\underline{Gaussian Process}} is a stochastic process s.t.
        every finite collection of those random variables has a multivariate
        normal distribution.
    \item The process is
        \[
            X_t=\mu t+\sigma B_t,\quad t\ge 0.
        \]
    \item It is a Gaussian process with the following properties:
        \begin{itemize}
            \item $\mathbb{E}[X_t]=\mu t$,
            \item Cov$(X_t, X_s)=\sigma^2\min\left\{t,s\right\}$. (Practice!)
        \end{itemize}
\end{itemize}

\subsection{Geometric Brownian Motion with Drift}

\begin{itemize}
    \item The process is
        \[
            X_t=e^{\mu t+\sigma B_t},\quad t\ge 0.
        \]
    \item It is \emph{not} Gaussian, but log-normal instead, with the following
        properties:
        \begin{itemize}
            \item $\mathbb{E}[X_t]=e^{\mu t+\frac{1}{2}\sigma^2t}$, (Practice!)
            \item
                $\text{Cov}(X_t,X_s)=e^{\left(\mu+\frac{1}{2}\sigma^2\right)(t+s)}\left(e^{\sigma^2s}-1\right)$.
                (Practice!)
        \end{itemize}
\end{itemize}


\section{Stochastic Integration}

\subsection{Time Value of Money}

\begin{itemize}
    \item \textsterling $x$ today is worth more than \textsterling $x$ in the
        future.
    \item Compensation for postponed consumption
    \item Inflation: prices may rise so \textsterling $x$ in the future will not
        have the same purchasing power
    \item Risk -- money in the future may never be received.
\end{itemize}

\subsection{Interest}

\subsubsection{Definitions}

\begin{itemize}
    \item $V(t)$: value of investment at time $t$
    \item $r$: interest rate $r\ge 0$
    \item $t$: time measured in years
    \item $P$: principal/initial investment (\textsterling)
    \item simple/annual compounding:
        \[
            \begin{cases}
                V(0) &= P \\
                V(t) &= (1 + tr) P
            \end{cases}
        \]
\end{itemize}

\subsubsection{Compounding}

\begin{itemize}
    \item Periodic, e.g. monthly compounding:
        \[
            V(t) = {\left(1+\frac{r}{12}\right)}^{t}P
        \]
    \item Continuous:
        \begin{align*}
            V(t) = e^{tr}P
            &\quad\Longrightarrow\quad
            \frac{\mathrm{d}V(t)}{\mathrm{d}t}=rV(t) \\
            &\quad\Longrightarrow\quad
            V(t)=V(0)+\int_{0}^{t}rV(s)\mathrm{d}s.
        \end{align*}
\end{itemize}

\subsubsection{Stochastic Integral}

Example:
\[
    I(T) = \int_{0}^{T} B(t)\mathrm{d}B(t)
\]

Using left-hand point approximation, we can get
\begin{align*}
    I(T)
    &=
    \underset{L\rightarrow\infty}{\lim}\sum_{i=0}^{L-1}B(t_i)\left[B(t_{i+1})-B(t_i)\right]\\
    &= \underset{L\rightarrow\infty}{\lim}\sum_{i=0}^{L-1}
    -\frac{1}{2}B(t_i)^2-\frac{1}{2}{[B(t_{i+1})-B(t_i)]}^{2}
    +\frac{1}{2}B(t_{i+1})^2 \\
    &= \frac{1}{2}\underset{L\rightarrow\infty}{\lim}\sum_{i=0}^{L-1}
    [B(t_{i+1})^2-B(t_i)^2]-\delta B_i^2
\end{align*}
where $\delta B_i=B(t_{i+1})-B(t_i)$. Analyzing the above expression
(exercise!), we can obtain
\[
    I(T) = \frac{1}{2}B(T)^2 - \frac{1}{2}T.
\]
We can also show the following: (exercise!)
\begin{itemize}
    \item $\mathbb{E}[\delta B_i]=0$
    \item $\text{Var}(\delta B_i) = \delta t$
    \item $\mathbb{E}[\delta B_i^2]=\delta t$
    \item $\text{Var}(\delta B_i^2) = 2{(\delta t)}^{2}$\quad
        (hint: $\mathbb{E}[Z^4]=3$ for $Z\sim N(0,1)$)
\end{itemize}

\section{Stochastic Calculus}

\subsection{Ito's Formula}

\subsubsection{Ito's Multiplication Rules}

\begin{align*}
    {(\mathrm{d}t)}^{2} &= 0, \\
    (\mathrm{d}t)(\mathrm{d}B(t)) &= 0, \\
    (\mathrm{d}B(t))^2 &= \mathrm{d}t.
\end{align*}

\subsubsection{Ito's Lemma}

Consider an \textbf{\underline{Ito's process}}
\[
    \mathrm{d}X_t = \mu_t\mathrm{d}t + \sigma_t\mathrm{d}B_t,
\]
where
\begin{itemize}
    \item $\mu_t$ (or just $\mu$): drift process,
    \item $\sigma_t$ (or just $\sigma$): diffusion process,
\end{itemize}
both can be either stochastic or deterministic.
Using the multiplication rules, we can derive that
\[
    {(\mathrm{d}X_t)}^{2}=\mu^2(\mathrm{d}t)^2+\sigma^2(\mathrm{d}B_t)^2
    +2\mu\sigma(\mathrm{d}t)(\mathrm{d}B_t)=\sigma^2\mathrm{d}t.
\]
Let $Z(t)=f(t,X_t)$, then
\begin{align*}
    \mathrm{d}Z(t)
    &= \frac{\partial f}{\partial X_t}\mathrm{d}X_t
    +\frac{\partial f}{\partial t}\mathrm{d}t
    +\underbrace{\frac{1}{2}\frac{\partial^2 f}{\partial
    X_t^2}{(\mathrm{d}X_t)}^{2}}_{\text{It\^{o} correction}} \\
    &= \left(\frac{\partial f}{\partial t}
    +\mu\frac{\partial f}{\partial X_t} 
    +\frac{1}{2}\sigma^2\frac{\partial^2 f}{\partial X_t^2}\right)\mathrm{d}t
    +\frac{\partial f}{\partial X_t}\sigma\mathrm{d}B(t).
\end{align*}

\subsubsection{Examples}

\begin{enumerate}
    \item $\mathrm{d}X_t=\mathrm{d}W_t$, $f(t,x)=te^{\alpha x}$.
        Since
        \[
            \frac{\partial f}{\partial t}=e^{\alpha x},\quad
            \frac{\partial f}{\partial x}=\alpha te^{\alpha x},\quad
            \frac{\partial^2 f}{\partial x^2}=\alpha^2te^{\alpha x},
        \]
        and in this case $\mu=0$, $\sigma=1$, we have
        \[
            \mathrm{d}f(t,W_t) = 
            \left(e^{\alpha x}+
            +\frac{1}{2}\alpha^2te^{\alpha W_t}\right)\mathrm{d}t
            +\alpha te^{\alpha W_t}\mathrm{d}W_t
        \]

    \item $\mathrm{d}X=\mathrm{d}W$, $f(x)=x^2$.
        \begin{align*}
            \mathrm{d}f(t,W_t)
            &= \frac{\partial f}{\partial t}\mathrm{d}t
            +\frac{\partial f}{\partial x}\mathrm{d}x
            +\frac{1}{2}\frac{\partial^2 f}{\partial x^2}\mathrm{d}t \\
            &= 0 + 2W\mathrm{d}W + \frac{1}{2}2\mathrm{d}t \\
            &= \mathrm{d}t+2W_t\mathrm{d}W_t
        \end{align*}

    \item Compute $\mathbb{E}\left[B_t^4\right]$. This could be transformed to
        the question
        \[
            \mathrm{d}X_t=\mathrm{d}B_t,\quad
            Z_t=X_t^4.
        \]
        Thus,
        \[
            \mathrm{d}Z_t=6B_t^2\mathrm{d}t+4B_t^3\mathrm{d}B_t,
        \]
        i.e.\
        \[
            Z_t=Z_0 + 6 \int_{0}^{t}B_s^2\mathrm{d}s
            + 4 \int_{0}^{t} B_s^3\mathrm{d}B_s
        \]
        so
        \begin{align*}
            \mathbb{E}[B_t^4]=\mathbb{E}Z_t
            &= 0 + 6 \int_{0}^{t} \mathbb{E}[B_s^2]\mathrm{d}s
            + 4 \int_{0}^{t} \mathbb{E}[B_s^3]\mathrm{d}B_s \\
            &= 6 \int_{0}^{t}s\mathrm{d}s + 0 \\
            &= 3t^2
        \end{align*}
\end{enumerate}

\subsection{Stochastic Differential Equation}

\paragraph{Example}
Given that
\[
    \mathrm{d}S(t)=\mathrm{d}B(t),\quad
    u(t,x)=y_0e^{\mu t + \sigma x},
\]
and
\[
    Y(t) = u(t, S),\quad
    Y(0)=y_0,
\]
we have
\begin{align*}
    \mathrm{d}Y_t
    &=\mu u(t,S)\mathrm{d}t+\sigma u(t,s)\mathrm{d}B
    +\frac{1}{2}\sigma^2 u(t,s)\mathrm{d}t \\
    &=\left(\mu+\frac{1}{2}\sigma^2\right)Y(t)\mathrm{d}t
    +\sigma Y(t)\mathrm{d}B_t.
\end{align*}
This gives hint on how to solve
\[
    \mathrm{d}Y(t)=\mu Y(t)\mathrm{d}t+\frac{1}{2}\sigma Y(t)\mathrm{d}B_t,
\]
whose solution is
\[
    Y(t)=u(t,B_t)
    =y(0)e^{\left(\mu - \frac{1}{2}\sigma^2\right)t+\sigma B_t}.
\]
This can be solved with a change of variable
\[
    Z(t)=\ln Y(t).
\]
Applying Ito's lemma, we can derive that
\begin{align*}
    \mathrm{d}Z(t)
    &=\frac{1}{Y(t)}\mathrm{d}Y(t)-\frac{1}{2}\frac{1}{Y(t)^2}\sigma^2Y(t)^2\mathrm{d}t\\
    &=\mu\mathrm{d}t+\sigma\mathrm{d}B(t)-\frac{1}{2}\sigma^2\mathrm{d}t \\
    &=\left(\mu-\frac{1}{2}\sigma^2\right)\mathrm{d}t+\sigma\mathrm{d}B_t
\end{align*}
Integrating both sides from 0 to $t$, we get
\[
    Z(t)-Z(0)=\ln{\frac{Y(t)}{Y(0)}}
    =\left(\mu-\frac{1}{2}\sigma^2\right)t+\sigma B_t
\]
leading to the solution.


\subsection{SDE \& PDE}

Consider the SDE
\begin{align*}
    \mathrm{d}X_s
    &= \mu(s,X_s)\mathrm{d}s+\sigma(s,B_s)\mathrm{d}B_s,\\
    X_t &= x,
\end{align*}
which starts at $x$ at time $t$ and evolves in the interval $\left[t,T\right]$.
Now the parabolic PDE
\begin{align*}
    \frac{\partial F}{\partial t}+\mu(t,x)\frac{\partial F}{\partial x}
    +\frac{1}{2}\sigma^2(t,x)\frac{\partial^2 F}{\partial x^2}
    =\frac{\partial F}{\partial t}+\mathcal{A}F=0 \\
    F(T,x) = \phi(x),
\end{align*}
where
\[
    \mathcal{A}=\mu(t,x)\frac{\partial}{\partial
    x}+\frac{1}{2}\sigma^2(t,x)\frac{\partial^2}{\partial x^2}
\]
is called the \emph{infinitesimal operator}.
Applying Ito's Lemma to $F(s,X(s))$, we have
\[
    \mathrm{d}F=\frac{\partial F}{\partial t}\mathrm{d}t
    +\frac{\partial F}{\partial X}\mathrm{d}X
    +\frac{1}{2}\sigma^2\frac{\partial^2 f}{\partial X^2}\mathrm{d}t.
\]
Integrate from $t$ to $T$, we get
\begin{align*}
    &F(T,X_T)-F(t,X_t)\\
    =&\int_{t}^{T}\underbrace{\left[\frac{\partial F(s,X_s)}{\partial t}
    +\frac{\partial F(s,X_s)}{\partial X}\mu(s,X_s)
    +\frac{1}{2}\sigma^2\frac{\partial^2 F(s,X_s)}{\partial X^2}
    \right]}_{\text{exactly the PDE, $=0$}}\mathrm{d}s\\
     &+\int_{t}^{T}\sigma(s,X_s)\frac{\partial F(s,X_s)}{\partial
     X}\mathrm{d}W_s \\
    =&\int_{t}^{T}\left[\frac{\partial F(s,X_s)}{\partial
    t}+\mathcal{A}F(s,X_s)\right]\mathrm{d}s+\int_{t}^{T}
    \sigma(s,X_s)\frac{\partial F(s,X_s)}{\partial X}\mathrm{d}W_s\\
    =&\int_{t}^{T}\sigma(s,X_s)\frac{\partial F(s,X_s)}{\partial
    X}\mathrm{d}W_s,
\end{align*}
\[
    \Longrightarrow\quad
    \phi(X_T)-F(t,X)=\int_{t}^{T}\sigma(s,X_s)\frac{\partial F(s,X_s)}{\partial
    X}\mathrm{d}W_s
\]
Taking expectation on both sides (conditional on $t$),
\[
    \mathbb{E}\phi(X_T)-\mathbb{E}[F(t,X(t))|X(t)=x]
    =\mathbb{E}\left[\int_{t}^{T}\sigma(s,X_s)\frac{\partial F(s,X_s)}{\partial
    X}\mathrm{d}W_s|X(t)=x\right].
\]
Since stochastic integral has 0 expectation, i.e.\
\[
    F(t,X)=\mathbb{E}\left[\phi(X_T)|X(t)=x\right]
\]
The above conclusion is the \textbf{\underline{Feynman Kac Theorem}}

\newmdtheoremenv[style=defEnv]{feynman kac}[theorem]{Proposition}
\begin{feynman kac}
    If $F$ is a solution to
    \[
        \frac{\partial F}{\partial t}+\mathcal{A}F=0,\quad
        F(T,X)=\phi(X),
    \]
    where $\mathcal{A}$ is the infinitesimal operator associated with the SDE
    \[
        \mathrm{d}X_s=\mu(s,X_s)\mathrm{d}s+\sigma(s,X_s)\mathrm{d}W_s,\quad
        X_t=x
    \]
    then
    \[
        F(t,x)=\mathbb{E}\left[\phi(X_T)|X_t=x\right]
    \]
\end{feynman kac}
\paragraph{Note} By ``associated'' means that the quantity $\mu$ and $\sigma$
are the same in both SDE and PDE.

\newtheorem{feynman kac eg}[theorem]{Example}
\begin{feynman kac eg}
    Solve the PDE
    \[
        \frac{\partial F}{\partial t}+\frac{1}{2}\sigma^2\frac{\partial^2
        F(t,x)}{\partial x^2}=0,\quad
        F(T,x)=x^2
    \]
    using the Feynman Kac formula. Let
    \[
        \mathrm{d}X_s=\sigma\mathrm{d}W_s,\quad X_t=x
    \]
    The solution to the SDE is
    \[
        X_t=x+\sigma\left[W_T-W_t\right]
    \]
    implying that $X_T\sim N(x,\sigma^2(T-t))$.
    So
    \[
        F(t,x)
        =\mathbb{E}X_T^2
        =\sigma^2(T-t)+x^2.
    \]
\end{feynman kac eg}

\section{Arbitrage Pricing}

\subsection{Definitions}

\begin{itemize}
    \item \textbf{\underline{out-of-the-money (OTM)}} for a call means
        $S(t)-K<0$.
    \item \textbf{\underline{in-the-money}} for a call means $S(t)-K > 0$.
    \item \textbf{\underline{at-the-money}} for a call means $S(t)=K$.
    \item \textbf{\underline{Exotic options}}: more complicated products that
        have ``exotic'' features, e.g. early exercise, multiple strikes, etc.
\end{itemize}

\subsection{The Black \& Scholes Model and Arbitrage}

\subsubsection{Model Introduction}

The model is based on:
\begin{enumerate}
    \item risk-free bank (letter $B$ stands for bank): 
        \[
            \mathrm{d}B(t)=rB(t)\mathrm{d}t\quad\Rightarrow\quad
            B(t)=B(0)e^{rt}
        \]
    \item stock:
        \[
            \mathrm{d}S(t)=\mu S(t)\mathrm{d}t+\sigma S(t)\mathrm{d}W(t),\quad
            S(0)=s(0)
        \]
        \[
            \Rightarrow\quad
            S(t)=S(0)e^{\left(\mu-\frac{1}{2}\sigma^2\right)t+\sigma W_t}
        \]
    \item option, that depends on stock price and the current time:
        \[
            V(t,S).
        \]
\end{enumerate}

\subsubsection{The PDE approach of pricing}

The model:
\[
    \mathrm{d}B_t=rB_t\mathrm{d}t,\quad
    \mathrm{d}S_t=\mu S_t\mathrm{d}t+\sigma S_t\mathrm{d}W_t
\]
Applying Ito's lemma on $V(t,S)$, we have
\begin{align*}
    \mathrm{d}V
    &=\frac{\partial V}{\partial t}\mathrm{d}t
    +\frac{\partial V}{\partial S}\mathrm{d}S
    +\frac{1}{2}\frac{\partial^2 V}{\partial S^2}{(\mathrm{d}S)}^{2}\\
    &=\left[\frac{\partial V}{\partial t}+\mu S\frac{\partial V}{\partial S}
    +\frac{1}{2}\sigma^2S^2\frac{\partial^2 V}{\partial S^2}\right]\mathrm{d}t
    +\sigma S\frac{\partial V}{\partial S}\mathrm{d}W_t.
\end{align*}
Consider a portfolio $P(t)$ with $\Delta$ stocks and one short option
(\textbf{\underline{Delta hedging}}).
The value of the portfolio is
\[
    P(t)=\underbrace{\Delta S(t)}_{\text{long the stock}}-
    \underbrace{V(t)}_{\text{short the option}}
\]
The portfolio evolves according to
\begin{align*}
    \mathrm{d}P(t)
    &=\Delta\mathrm{d}S(t)-\mathrm{d}V\\
    &=\left[\Delta\mu S-\frac{\partial V}{\partial t}-\mu S\frac{\partial
    V}{\partial S}-\frac{1}{2}\sigma^2S^2\frac{\partial^2V}{\partial S^2}\right]
    \mathrm{d}t+\left[\Delta\sigma S-\sigma S\frac{\partial V}{\partial
    S}\right]\mathrm{d}W_t.
\end{align*}
If we let $\Delta=\frac{\partial V}{\partial S}$,
because if the market has no arbitrage then its return must equal
$rP\mathrm{d}t$, 
we are left with
\[
    \mathrm{d}P=\left[\Delta\mu S-\frac{\partial V}{\partial t}-\mu S\frac{\partial
    V}{\partial S}-\frac{1}{2}\sigma^2S^2\frac{\partial^2V}{\partial S^2}\right]
    \mathrm{d}t
    =rP\mathrm{d}t
\]
\[
    \Rightarrow\quad
    \Delta\mu S-\frac{\partial V}{\partial t}-\mu S\frac{\partial
    V}{\partial S}-\frac{1}{2}\sigma^2S^2\frac{\partial^2V}{\partial S^2}\right]
    =rP
\]
Since $P=\frac{\partial V}{\partial S}S-V, \Delta=\frac{\partial V}{\partial
S}$, after these substitution, we obtain the following second-order parabolic
PDE called the \textbf{\underline{Black \& Scholes Equation (BSE)}}:
\[
    \frac{1}{2}\sigma^2S^2\frac{\partial^2 V}{\partial S^2}+rS\frac{\partial
    V}{\partial S}+\frac{\partial V}{\partial t}=rV,\quad
    V(T,S)=\text{max}(S-K,0),
\]
where the second equation is the boundary condition for European call option.

\paragraph{Hedge Parameters}
The following parameters (appearing in the PDE) are the sensitivities of the
option value w.r.t. small changes in the problem.

\begin{itemize}
    \item 
        \[
            \Delta=\frac{\partial V}{\partial S}
        \]
        It tells the trader how to balance the portfolio so that it is always
        equal to the option.
    \item 
        \[
            \Gamma=\frac{\partial^2 V}{\partial S^2}
        \]
        It gives an indication of how stable the hedging portfolio is. If
        $\Gamma$ is large, the trader needs to rebalance more often.
    \item
        \[
            \theta=\frac{\partial V}{\partial t}
        \]
        If $S$ stays constant then the value of the option will change by
        $\theta$
    \item
        \[
            \zeta=\frac{\partial V}{\partial \sigma}
        \]
        It measures the change in price w.r.t. volatility
    \item
        \[
            \rho=\frac{\partial V}{\partial r}
        \]
        It measures sensitivity w.r.t. interest rate.
\end{itemize}

\subsubsection{The Martingale Method of Pricing}

Option valuation could be reduced to the calculation of the following:
\[
    V(S_0)=\mathbb{E}^{Q}\left[e^{-rT}V(S_T)|S_0\right].
\]
In the case of the Black-Scholes model, $Q$ is the probability distribution of
the following SDE
\[
    \mathrm{d}S_t=rS_t\mathrm{d}t+\sigma S_t\mathrm{d}W_t
\]
or
\[
    S(t)=S(0)e^{\left(r-\frac{1}{2}\sigma^2\right)t+\sigma W_t}
\]
where
\begin{itemize}
    \item $r$: risk-free rate
    \item $\sigma$: volatility
    \item $w$: standard brownian motion
\end{itemize}
This says that the assumption of the Black Scholes model is that the underlying
asset follows a geometric Brownian motion i.e.\ lognormal random walk.


\section{Monte-Carlo methods}

\subsection{Strong Law of Large Numbers}

Let $\xi^{(i)}$, $i=1,2,\ldots,N$ be i.i.d. random variables with values in
$\mathbb{R}^{d}$, and mean $\mathbb{E}|\xi|<\infty$.
Let $\hat{S}_N$ denote the empirical mean
$\hat{S}_N=\frac{1}{N}\sum_{i=1}^{N}\xi^{(i)}$. Then the SLLN holds true:
\[
    \underset{N\rightarrow\infty}{\lim}\hat{S}_N=\mathbb{E}(\xi)
\]

\subsection{Central Limit Theorem}
Let $\xi^{(i)}$, $i=1,2,\ldots,N$ be i.i.d. random variables with
mean $\mathbb{E}\xi$ and Var$(\xi)<\infty$. Then
\[
    Y_N=\frac{\sqrt{N}}{\sigma}\left(\frac{1}{N}\sum_{i=1}^{N}\xi^i-\mathbb{E}\xi\right)
    \longrightarrow_d
    Z\sim N(0,1)
\]
as $N\rightarrow\infty$. 
In practice, we use empirical variance to compute $\sigma$ (unbiased estimate):
\[
    \sigma^2_N=\frac{1}{N-1}\sum_{i=1}^{N}{\left(\xi^i-\overline{\xi}\right)}^{2}.
\]
In other words,
\[
    \mathbb{P}\left(\left|\frac{\sqrt{N}}{\sigma}\left(\frac{1}{N}\sum_{i=1}^{N}\xi^i-\mathbb{E}\xi\right)\right|<R\right)
    \longrightarrow
    \int_{-R}^{R}\frac{1}{\sqrt{2\pi}}e^{-\frac{x^2}{2}}\mathrm{d}x
\]

\subsection{Monte Carlo for Option Valuation}

Since
\[
    S(T)=S(0)e^{\left(r-\frac{1}{2}\sigma^2\right)T+\sigma\sqrt{T}Z},\quad
    Z\sim N(0,1),
\]
if we can generate i.i.d. normal random variables $\left\{Z^i\right\}$,
$i=1,2,\ldots,N$, we have
\[
    V(S_0)\approx \frac{1}{N}\sum_{i=1}^{N}V(S_T^i)e^{-rT}=V_N(S_0),
\]
where
\[
    S_T^i=e^{\left(r-\frac{1}{2}\sigma^2\right)T+\sqrt{T}Z^i}
\]

\subsection{Variance Reduction methods for MC}

\subsubsection{Antithetic Variables}

If $X_1$ and $X_2$ are i.i.d. RVs,
\[
    \text{Var}\left(\frac{X_1+X_2}{2}\right)
    =\frac{1}{4}\left(\text{Var}(X_1)
    +\text{Var}(X_2)+2\text{Cov}(X_1,X_2)\right)
\]
so variance is reduced if $\text{Cov}(X_1,X_2)<0$.

Let $f(x)$ be monotonic. 
For instance, in the case of \underline{Gaussian variables} $X$, 
$f(x)$ and $f(-x)$ are negatively correlated, i.e.\
\[
    \text{Cov}(f(X), f(-X)) < 0.
\]
In the case of \underline{uniform distribution variables} $U$, 
\[
    \text{Cov}(f(U), f(1-U)) < 0.
\]

\subsubsection{Control Variates}

Suppose we want to estimate $\mathbb{E}X$ and know the mean of another random
variable $Y$, $\mathbb{E}Y$, then
\[
    \mathbb{E}X=\mathbb{E}[X-Y+\mathbb{E}Y].
\]
$Y$ is called a control variate. While the expectation of
\[
    Z=X-Y+\mathbb{E}Y
\]
is $\mathbb{E}X$ its variance will be
\[
    \text{Var}(X-Y)=\text{Var}(X)+\text{Var}(Y)-2\text{Cov}(X,Y).
\]
This idea works when $X$ and $Y$ are close.

\subsubsection{Importance Sampling}

We can write the expectation with respect to the probability density $p$ as
\[
    \mathbb{E}^pg(X)=\int g(x)p(x)\mathrm{d}x.
\]
Suppose that we had another density $q$ that had the same support i.e.\
$p(x)>0\iff q(x)>0$, then
\[
    \mathbb{E}^pg(x)
    =\int g(x)p(x)\mathrm{d}x
    =\int g(x) \frac{p(x)}{q(x)}q(x)\mathrm{d}x
    =\mathbb{E}^qg(x) \frac{p(x)}{q(x)}
\]
Thus instead of calculating $\mathbb{E}^pg(x)$ using i.i.d. samples from $p$ we
calculate
\[
    \mathbb{E}^qg(x)\Lambda(x)
\]
using samples from $q$, where $\Lambda(x)$ is the likelihood ratio.

\subsection{Computation of Monte-Carlo Greeks}

Monitoring the P\&L of the hedging portfolio
\[
    \pi(t,s)=V(t,s)-\Delta S(t).
\]




\end{document}
